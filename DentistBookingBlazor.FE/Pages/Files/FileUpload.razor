@page "/fileupload"
@using System.IO
@inject HttpClient httpClient
<h3>Upload File</h3>

<InputFile OnChange="LoadImage"></InputFile>
<label>Client-Side</label>
<img src="@imageDataUri" />


@code {
    long maxFileSize = 1024 * 1024 * 15;
    string imageDataUri;
    async Task LoadImage(InputFileChangeEventArgs e)
    {
        var imageFile = await e.File.RequestImageFileAsync("image/jpeg/png", maxWith: 640, maxHeight: 480);
        using Stream fileStream = imageFile.OpenReadStream(maxFileSize);
        using MemoryStream ms = new();
        await fileStream.CopyToAsync(ms);
        imageDataUri = $"data:image/jpeg/png;base64,{Convert.ToBase64String(ms.ToArray())}";
        //read and post to server
        var content = new MultipartFormDataContent
        {
            {
                new ByteArrayContent(ms.ToArray()),
                "\"file\"",
                e.File.Name

            },
        };
        var response=await httpClient.PostAsync("api/FileUpload", content);
        response.EnsureSuccessStatusCode();

    }
}